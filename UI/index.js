var articleContent = (function(){
	var articlesTMP = [
	{
		id: '1',
		title: 'Есть кто живой?',
		summary: 'У близкой к Солнцу звезды обнаружили семь двойников Земли',
		img: 'http://www.mpnnow.com/storyimage/NU/20170222/NEWS/170229840/AR/0/AR-170229840.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["space", "stars"],
		content: 'Ученые выяснили, что у одной из небольших звезд, относительно близких к Солнцу, есть семь планет, похожих на Землю. Небесные тела достаточно удалены от красного карлика, чтобы температура на их поверхности не превышала ста градусов Цельсия и на них могла существовать жидкая вода. «Лента.ру» делится подробностями об открытии, совершенном международной группой астрономов.Экзопланетами называют планеты, которые вращаются вокруг других звезд. Одна из задач современной астрономии — поиск миров, напоминающих Землю. По оценкам, в галактике Млечный Путь находится 5-20 миллиардов двойников нашей планеты. Чтобы их найти, ученые пользуются специальными методами. Один из них — транзитный, основанный на наблюдении за прохождением небесного тела на фоне звезды.В 2016 году Михаэль Жийон (Michaël Gillon) из Льежского университета в Бельгии и его коллеги сообщили, что им удалось обнаружить три экзопланеты, которые проходили на фоне одиночного красного карлика TRAPPIST-1 (расстояние до него — 39 световых лет). Свое название эта звезда получила из-за того, что ее открыли с помощью 0,6-метрового телескопа TRAPPIST (TRAnsiting Planets and PlanetesImals Small Telescope) в обсерватории ESO Ла-Силья в Чили. Этот красный карлик лишь на 11 процентов крупнее Юпитера. Одна из трех экзопланет — TRAPPIST-1d — была зарегистрирована на основе двух транзитных сигналов, то есть астрономы наблюдали два прохождения этой планеты по диску красного карлика. Второе прохождение было зафиксировано с помощью «Очень большого телескопа» (VLT) в Чили. Когда ученые проанализировали полученные данные, оказалось, что затмение было тройное. Это заставило провести более тщательные фотометрические наблюдения звезды. Астрономы проследили за шестью возможными транзитами TRAPPIST-1d с февраля по сентябрь 2016 года, используя космическую обсерваторию «Спитцер» и несколько наземных телескопов, включая TRAPPIST. Новые сведения позволили отвергнуть 11 предложенных ранее возможных периодов обращения экзопланеты вокруг звезды. Более того, выяснилось, что наблюдаемые два транзита относились к различным объектам. Обсерватория «Спитцер», наблюдавшая звезду в течение 20 дней осенью 2016 года, получила кривые блеска, указывающие на 34 транзита. Новые данные, совмещенные с имеющимися, позволили выделить четыре транзитных сигнала с периодом 4,04 дня, 6,06 дня, 8,1 дня и 12,3 дня. Они соответствовали как уже обнаруженной экзопланете — TRAPPIST-1d, так и новым — TRAPPIST-1e, TRAPPIST-1f и TRAPPIST-1g. Кроме того, был зафиксирован еще один транзитный сигнал, принадлежащий самой отдаленной от звезды планете TRAPPIST-1h, чей период пока неизвестен. Статистический анализ кривых блеска предоставил некоторую информацию о семи обнаруженных мирах и траекториях их орбит. Ученые с помощью динамической симуляции определили, какие формы должны быть у орбит, чтобы сложилась наблюдаемая картина. Установлено, что шесть внутренних экзопланет движутся по приблизительно круговым траекториям. Об орбите седьмой планеты данных нет. Астрофизики смогли понять, как взаимодействуют планеты друг с другом, вычислить примерные массы шести внутренних планет и выявить их приблизительный химический состав. Так, пять планет (b, c, e, f и g) по размеру сравнимы с Землей, а диаметр двух других (d и h) меньше земного, но больше марсианского. Шесть внутренних планет являются железокаменными, при этом сравнительно малая плотность TRAPPIST-1f указывает на то, что ее окутывает мощная газовая оболочка либо толстый слой приповерхностного льда. Авторы открытия подчеркивают, что для уточнения химического состава необходимы дальнейшие наблюдения с применением таких космических телескопов, как «Хаббл» и «Джеймс Уэбб» (второй должны запустить в 2018 году). Ученые выяснили, что b, c, e, f, g и d формируют самую длинную из известных резонансных цепочек орбит экзопланет. Орбитальный резонанс происходит, когда два вращающихся вокруг одной звезды объекта оказывают друг на друга гравитационное воздействие. В результате их периоды обращения соотносятся друг с другом как небольшие натуральные числа, и планеты время от времени сближаются, находясь в одних и тех же точках орбит. Например, в Солнечной системе два оборота Сатурна почти соответствуют по времени пяти оборотам Юпитера. Отношения периодов обращения пар планет c/b, d/c, e/d, f/e и g/f составляют 8/5, 5/3, 3/2, 3/2 и 4/3, соответственно. До этого длинные резонансные цепочки были обнаружены в компактных системах, в которых вокруг звезд, похожих на Солнце, вращаются суперземли и нептуны. Установлено, что на поверхность внутренних планет поступает столько же солнечной радиации, сколько на Венеру, Землю или Марс. Однако все семь планет, по всей вероятности, находятся в приливном захвате с родительской звездой. Значит, небесные тела повернуты к красному карлику всегда одной стороной, что ухудшает условия на их поверхности. С учетом излучения, поступающего от TRAPPIST-1, только экзопланеты e, f и g могут быть покрыты водным океаном и их атмосфера похожа на земную. На планетах b, c и d, расположенных ближе к красному карлику, скорее всего, царит жара из-за мощного парникового эффекта, что делает их похожими на Венеру. Что касается самой далекой планеты, то температура на ее поверхности, вероятно, ниже точки плавления льда. Однако на ней все же может существовать жидкая вода благодаря нагреванию из-за приливных процессов или наличию обогащенной водородом атмосферы, препятствующей потере тепла. Ученые подчеркивают: в настоящее время орбитальные характеристики экзопланет системы TRAPPIST-1 слишком неопределенны, чтобы со стопроцентной уверенностью говорить об условиях на их поверхности. Тем не менее эти миры предоставляют астрономам уникальную возможность исследовать систему, напоминающую Солнечную, но с более холодной звездой. '
	},
	{
		id: '2',
		title: 'Много чести',
		summary: 'Кто кого заборет: викинг, рыцарь или самурай — обзор For Honor',
		img: 'http://static2.cdn.ubi.com/ncsa/forhonor/website/og/ForHonor_og_1200x630.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Стасик',
		tags:["ubisoft", "forHonor", "games", "vikings"],
		content:'В мире For Honor бок о бок живут рыцари, викинги и самураи. Все у них было хорошо, но из-за нехватки ресурсов началась тысячелетняя война. В это время появляется некая загадочная женщина и усугубляет ситуацию своими подстрекательствами. Вот так скучно и наивно происходит знакомство игрока с одиночной кампанией. В Ubisoft даже не пытаются заигрывать с историчностью, ведь в качестве основы использовались достойные второсортных пеплумов стереотипы, а не каноничные образы. Так и появились в игре полуголые викинги с рожками и самураи с толстенными железными пластинами на груди. Разработчики выбрали великолепный сеттинг и даже попытались как-то объяснить, почему эти фракции воюют между собой. Но, похоже, на этом запал создателей пропал, и ничего путного из истории For Honor не вышло. Есть три героя от разных сторон конфликта и злобный антагонист, которого нужно победить. По ходу будут встречаться нестандартные ситуации и боссы уровней, которые как-то разбавляют геймплей, но у игры и это плохо получается.'
	},
	{
		id: '3',
		title: 'Американская и сверхтяжелая',
		summary: 'В 2017 году SpaceX запустит мощнейшую в мире ракету-носитель',
		img: 'http://www.universetoday.com/wp-content/uploads/2016/04/26405462060_81f8289687_k.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["space", "spaceX"],
		content:'Новый 2017 год обещает стать для американской SpaceX одним из самых важных в ее истории. Компании предстоит запустить сверхтяжелую ракету Falcon Heavy. Именно на носителях такого класса американцы успешно летали на Луну. Но дело не только в этом. «Лента.ру» рассказывает о планах SpaceX на ближайшие двенадцать месяцев. Минувший год был для SpaceX неоднозначным. С одной стороны, в апреле первой ступени средней ракеты Falcon 9 удалось успешно сесть на морскую платформу, с другой — через пять месяцев, в сентябре, на стартовой площадке, на мысе Канаверал, произошел взрыв носителя этого же типа. Причина аварии установлена: трещина в системе подачи гелия в резервуар с жидким кислородом на второй ступени.'
	},
	{
		id: '4',
		title: 'Взрыв года',
		summary: 'Астрофизики впервые наблюдали разрушение звезды',
		img: 'http://luxfon.com/images/201306/luxfon.com_21617.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["space", "stars", "supernova"],
		content:'Астрофизикам из Европы и Северной Америки впервые удалось проследить за эволюцией бывшего красного сверхгиганта спустя всего три часа после его взрыва как сверхновой звезды II типа. Вспышка в соседней с Млечным Путем галактике NGC 7610, зафиксированная на Земле более трех лет назад, привлекла внимание множества ученых. «Лента.ру» рассказывает об исследовании, посвященном этому событию, которое опубликовано в журнале Nature Physics.'
	},
	{
		id: '5',
		title: 'Тяжелый случай',
		summary: 'Доказано существование невозможного типа черных дыр',
		img: 'http://getbg.net/upload/full/www.GetBg.net_Space_The_black_hole_in_the_blue_haze_098077_.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["space", "blackhole"],
		content:'мериканские и австралийские астрофизики обнаружили кандидата в черные дыры средней массы. Такое название они получили потому, что тяжелее обычных — то есть формирующихся в результате гравитационного коллапса звезд — объектов, но легче сверхмассивных черных дыр, как правило расположенных в активных ядрах крупных галактик. Происхождение необычных объектов до сих пор остается неясным. «Лента.ру» рассказывает о черных дырах промежуточных масс и об открытии ученых.'
	},
	{
		id: '6',
		title: 'Ничего удивительного',
		summary: 'В Австралии обнаружили новый вид гигантских динозавров',
		img: 'http://svopi.ru/uploads/posts/2015-12/1449668589_1.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Verpad',
		tags:["dinosaurs", "australia"],
		content:'Австралийские ученые обнаружили на континенте новый вид огромных травоядных динозавров — саваннозавров (Savannasaurus). Об этом говорится в статье, опубликованной в журнале Scientific Reports. Рост динозавра соответствовал таковому у современного жирафа, а длина его тела равнялась 15 метрам. Открытый исследователями вид относится к роду титанозавров. По мнению австралийсих палеонтологов, древние рептилии обитали на континенте порядка 95-98 миллионов лет назад. Ученые предполагают, что титанозавры в те времена были распространены по всей планете. В пользу этой гипотезы говорят останки представителей данного рода, обнаруженные в Южной Америке. При этом процесс расселения древних рептилий происходил не позже 105 миллионов лет назад. Именно тогда глобальное потепление разрушило естественный сухопутный путь животных из Южной Америки в Австралию через Антарктиду. Австралийские палеонтологи вместе с коллегами продолжат раскопки для того, чтобы подтвердить данную теорию.' 
	},
	{
		id: '7',
		title: 'Это конец',
		summary: 'Земле предрекли переворот магнитного поля',
		img: 'http://moarrr.su/image/full/John-Martin-%D0%96%D0%B8%D0%B2%D0%BE%D0%BF%D0%B8%D1%81%D1%8C-%D0%91%D0%B8%D0%B1%D0%BB%D0%B5%D0%B9%D1%81%D0%BA%D0%B8%D0%B5-%D0%BC%D0%BE%D1%82%D0%B8%D0%B2%D1%8B-73196600.jpeg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["endOfTheDays", "earth","apocalypse"],
		content:'Геофизики из Лидского университета Йон Маунд и Фил Ливермор полагают, что через пару тысяч лет произойдет инверсия магнитного поля Земли. Свои выводы британские ученые изложили в колонке издания The Conversation. «Лента.ру» приводит основные тезисы авторов и объясняет, почему геофизики скорее всего правы. Магнитное поле защищает Землю от опасного космического излучения, отклоняя заряженные частицы от планеты. Однако это силовое поле не постоянно. За всю историю планеты произошло по крайней мере несколько сотен инверсий магнитного поля, когда северный и южный магнитный полюса менялись местами.' 
	},
	{
		id: '8',
		title: 'Унижение машин',
		summary: 'Как издевательства над роботами приведут к краху человечества',
		img: 'https://k60.kn3.net/taringa/5/D/5/A/0/4/parBUX/5A8.jpg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Verpad',
		tags:["robots", "computerScience"],
		content:'На этой неделе Boston Dynamics на закрытом показе продемонстрировала своего нового робота — Handler. Его побаиваются сами создатели: говорят, что он вселяет ужас. Однако это далеко не самая пугающая разработка. В арсенале еще имеются робот-таракан, древолаз, прыгун на колесах и, конечно же, всем известные «собаки». «Лента.ру» вспомнила, над какими машинами работала американская компания и на что способны их роботы. Главная особенность Handle в том, что робот передвигается на двух колесах, как на сегвее. Его создатели объясняют, что это эксперимент по сочетанию колес и конечностей с динамической системой балансировки. Помимо того, что робот, по словам представителей компании, «нагоняет ужас», он способен переносить достаточно тяжелые грузы и перепрыгивать через препятствия.' 
	},
	{
		id: '9',
		title: 'Наперегонки со смертью',
		summary: 'Как Стивену Хокингу удалось дожить до старости',
		img: 'https://v1.std3.ru/f2/ad/1456174397-f2adf7743f0653f919fc8b0d49dc7328.jpeg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Nova',
		tags:["disabled", "life"],
		content:'Ученые из США выявили новое соединение, которое может продлить жизнь пациентов с боковым амиотрофическим склерозом. Этим заболеванием болен физик Стивен Хокинг, и несмотря на то, что оно убивает в течение нескольких лет, ученый прожил с ним больше полувека. «Лента.ру» рассказывает, как Хокингу удалось обмануть смерть и что делают исследователи для борьбы с неизлечимой болезнью. Боковой амиотрофический склероз (БАС), или мотонейронная болезнь, также известная в США как болезнь Лу Герига, — редкое заболевание центральной нервной системы, приводящее к параличам конечностей и атрофии мышц. Оно стало широко известно в 1939 году, когда установивший несколько рекордов американский бейсболист Генри Луи Гериг ушел из спорта в возрасте 36 лет. Оказалось, что он страдал от быстро прогрессировавших неизлечимых нарушений двигательных функций. Спортсмен скончался через два года после постановки диагноза.' 
	},
	{
		id: '10',
		title: 'Гроза-Р',
		summary: 'Белорусы показали на выставке в ОАЭ противодроновую винтовку',
		img: 'https://content.onliner.by/news/970x485/c5643e3bc3fc03f85d23fca7bccf8a1b.jpeg',
		createdAt: new Date('2017-03-06T21:29:00'),
		author: 'Хофр',
		tags:["drones", "rifles", "potatoe"],
		content:'Белорусы показали на выставке в ОАЭ противодроновую винтовку' 
	},
	];

	var id = 11;

	var authors = [];

	function getArticles(skip, top, filterConfig){
		if(skip < 0 || top < 0) return undefined;

		var articles = takeArticles();
		skip = skip || 0;
		top = top || articles.length;

		var articlesNew =  articles.filter(function(elem){
			key = true;
			if(Boolean(filterConfig)){
				var date = elem.createdAt;

				if(Boolean(filterConfig.author) && filterConfig.author != elem.author){
					key = false;
				}

				if(Boolean(filterConfig.createdAfter)){
					if(filterConfig.createdAfter.getFullYear() > date.getFullYear()){
						key = false;
					}
					else if(filterConfig.createdAfter.getFullYear() == date.getFullYear()){
						if(filterConfig.createdAfter.getMonth() > date.getMonth()){
							key = false;
						}
						else if(filterConfig.createdAfter.getMonth() == date.getMonth()){
							if(filterConfig.createdAfter.getDate() > date.getDate()){
								key = false;
							}
						}
					}
				}
				   	
				if(Boolean(filterConfig.createdBefore)){
					if(filterConfig.createdBefore.getFullYear() < date.getFullYear()){
						key = false;
					}
					else if(filterConfig.createdBefore.getFullYear() == date.getFullYear()){
						if(filterConfig.createdBefore.getMonth() < date.getMonth()){
							key = false;
						}
						else if(filterConfig.createdBefore.getMonth() == date.getMonth()){
							if(filterConfig.createdBefore.getDate() < date.getDate()){
								key = false;
							}
						}
					}
				}

				if(Boolean(filterConfig.tags)){
					var tmp = elem.tags.slice().sort();
					var tags = filterConfig.tags.slice().sort();
					for(var i = 0; i < tags.length; i++){
						var key1 = false;
						for(var j = 0; j < tmp.length; j++){
							if(tmp[j] == tags[i]){
								key1 = true;
							}
						}
						if(!key1){
							key = false;
						}
					}
				}

			}
			return key;
		});

		return articlesNew.slice(skip, skip + top);
	}

	function getArticle(id){
		var articles = takeArticles();
		for(var i = 0; i < articles.length; i++){
			if(articles[i].id == id)
				return articles[i];
		}
		return undefined;
	}
	
	function validateArticle(article){
		if( article.title.length == 0 || article.title.length > 99 ||
			article.summary.length == 0 || article.summary.length > 199  || 
			article.author.length == 0 || article.content.length == 0){
			return false;
		}
		tags = article.tags;
		for(var i = 0; i < tags.length; i++){
			if(tags[i].length == 0 || ~tags[i].indexOf(' ')){
				return false;
			}
		}
		return true;
	}

	function addArticle(article){
		if (getArticle(article.id)){
			return false;
		}
		if(validateArticle(article)){
			var articles = takeArticles();
			article.id = id;
			id++;
			articles.unshift(article);
			storeArticles(articles);

			var author = article.author;
			var key = true;
			
			authors.forEach(function(item){
				if(item == author){
					key = false;
				}
			});

			if(key){
				authors.push(author);
			}

			authors.sort();

			return true;
		}
		return false;
	}

	function editArticle(id, article){
		var articles = takeArticles();
		var tmp;
		for(var i = 0; i < articles.length; i++){
			if(articles[i].id == id)
				tmp = articles[i];
		}
		if(tmp){
			for(var val in article){
				if( val == "title"){
					if(article[val].length != 0 && article[val].length < 100){
						tmp.title = article[val];
					}
					else return false;
				}

				else if( val == "summary"){
					if(article[val].length != 0 && article[val].length < 200){
						tmp.summary = article[val];
					}
					else return false;
				}

				else if( val == "content"){
					if(article[val].length != 0){
						tmp.content = article[val];
					}
					else return false;
				}

				else if( val == "tags"){
					tmp.tags = article[val].slice();					
				}

				else if (val == "img")
					tmp.img == article[val];
			}
			storeArticles(articles);
			return true;
		}
		return false;
	}

	function removeArticle(id){
		var articles = takeArticles();
		for (var i = 0; i < articles.length; i++) {
			if(articles[i].id == id){
				articles.splice(i,1);
				storeArticles(articles);
				return true;
			}
		}
		return false;
	}

		function authorsInit(){
			var articles = takeArticles();
			articles.forEach(function(item){
			var author = item.author;
			var key = true;
			for(var i = 0; i < authors.length; i++){
				if(authors[i] == author){
					key = false;
				}
			}
			if(key){
				authors.push(author);
			}
		});
		authors.sort();
	}
	
	function storeArticles(item){
		if(Boolean(item)){
			localStorage.setItem('articles', JSON.stringify(item));
		}
		else{
			if(!localStorage.getItem('articles')){
				localStorage.setItem('articles', JSON.stringify(articlesTMP));
			}
		}
	}

	function takeArticles(){
		var articles = JSON.parse(localStorage.getItem('articles'));
		articles.forEach(function(item){
			item.createdAt = new Date(item.createdAt);
		});
		return articles;
	}

	function count(){
		return takeArticles.length;
	}

	return {
		storeArticles: storeArticles,
		count: count,
		authors: authors,
		authorsInit: authorsInit,
		getArticle: getArticle,
		getArticles: getArticles,
		removeArticle: removeArticle,
		editArticle: editArticle,
		addArticle: addArticle
	}
}());

var popularTags = (function(){
	var tags = [];
	var allTags = [];

	function init(num){
		if(typeof num != "number") return false;
		if(tags){
			tags.length = 0;
		}
		if(allTags){
			allTags.length = 0;
		}
		var tmp = [];
		var articles = articleContent.getArticles();
		for(var i = 0; i < articles.length; i++){
			for(var j = 0; j < articles[i].tags.length; j++)
				tmp.push(articles[i].tags[j]);
		}
		tmp.sort();

		var a = 0;
		if(tmp.length > 1){
			allTags.push(tmp[a]);
			for(var i = 1; i < tmp.length; i++){
				if(tmp[i] != tmp[i - 1] || i == (tmp.length - 1)){
					if((i - a) >= num){
						tags.push(tmp[a]);
						a = i;
					}
					allTags.push(tmp[i]);
					a = i;
				}
			}
		}
		else if(num == 1 && tmp.length == 1){
			tags.push(tmp[a]);
		}

		return true;
	}

	function removeTagsFromDOM(){
		document.querySelector('.tag-list').innerHTML = '';
		return true;
	}

	function insertTagsInDOM(){
		var tags1 = document.querySelector('.tag-list');

		tags1.textContent = 'Popular: '

		for(i = 0; i < tags.length; i++){
			var tmp1 = document.createElement('li');
			tmp1.innerHTML = "<li>" + tags[i] + "</li>";
			tags1.appendChild(tmp1);
		}

		return true;
	}

	return{
		allTags: allTags,
		init: init,
		removeTagsFromDOM: removeTagsFromDOM,
		insertTagsInDOM: insertTagsInDOM
	}
}());

var articleRenderer = ( function(){
	var ARTICLE_TEMPLATE;
	var ARTICLE_LIST;

	function init(){
		ARTICLE_TEMPLATE = document.querySelector('#template-article');
		ARTICLE_LIST = document.querySelector('.article-list');
	}

	function insertArticlesInDOM(articles) {
		var articlesNodes = renderArticles(articles);
		articlesNodes.forEach(function (node) {
			ARTICLE_LIST.appendChild(node);
			ARTICLE_LIST.lastElementChild.addEventListener('click', readMoreHandler);
		});
	}

	function renderArticles(articles) {
		return articles.map(function (article) {
			return renderArticle(article);
		});
	}

	function renderArticle(article) {
		var template = ARTICLE_TEMPLATE;
		template.content.querySelector('.article').dataset.id = article.id;
		template.content.querySelector('#article-title').textContent = article.title;
		template.content.querySelector('#article-img').src = article.img;
		template.content.querySelector('.article-summary').textContent = article.summary;
		template.content.querySelector('#article-publname').textContent = article.author;
		template.content.querySelector('#article-date').textContent = formatDate(article.createdAt);
		var tags = template.content.querySelector('.article-tags');
		tags.innerHTML = 'Tags: ';
		
		if(Boolean(article.tags)){
			for(i = 0; i < article.tags.length; i++){
				var tmp = document.createElement('li');
				tmp.innerHTML = "<li>" + article.tags[i] + "</li>";
				tags.appendChild(tmp);
			}
		}

		return template.content.querySelector('.article').cloneNode(true);
	}

	function formatDate(d) {
		return d.getDate() + '.' + (d.getMonth() + 1) + '.' + d.getFullYear() + ' ' +
		d.getHours() + ':' + d.getMinutes();
	}

	function removeArticlesFromDom () {
		ARTICLE_LIST.innerHTML = '';
	}

	return {
        init: init,
        insertArticlesInDOM: insertArticlesInDOM,
        removeArticlesFromDom: removeArticlesFromDom
    };
 }());

var userLog = ( function(){
	var userList = [
	{
		login: 'aspelled',
		password: 'devil1701'
	},
	{
		login: 'Kirios',
		password: 'xkiriosdaniels'
	},
	{
		login: 'bigbaddev',
		password: 'lmjkj99m'
	},
	];

	function init(login, password){
		for(var i = 0; i < userList.length; i++){
			if(userList[i].login == login){
				if(userList[i].password == password){
					localStorage.setItem('user', JSON.stringify(login));
					renderUser();
					return true;
				}
				return false;
			}
		}
		if(!Boolean(login)){
			localStorage.removeItem('user');
		}
		renderUser();
		return false;
	}

	function renderUser(){
		var user = JSON.parse(localStorage.getItem('user'));
		if(Boolean(user)){
			document.querySelector('#aAdd').textContent = 'Add';
			document.querySelector('.log-info').style.fontSize = '50%';
			document.querySelector('.log-info').innerHTML = 'Profile<br/><div id="username">' + user + '</div>';
		}
		else{
			document.querySelector('#aAdd').textContent = '';
			document.querySelector('.log-info').style.fontSize = '100%';
			document.querySelector('.log-info').innerHTML = 'Login';
		}
	}

	function username(){
		if(localStorage.getItem('user')){
			return JSON.parse(localStorage.getItem('user'));
		}
		else{
			return undefined;
		}
	}

	return{
		renderUser: renderUser,
		username: username,
		init: init
	};
}());

function readMoreHandler(event){
	window.onscroll = 0;
	var target = event.target;
	if(target == this.querySelector('#readMore') || target == this.querySelector('#article-img') || target == this.querySelector('#article-title')){    	
    	var id = this.dataset.id;
    	var article = articleContent.getArticle(id);

    	articleRenderer.removeArticlesFromDom();
    	popularTags.removeTagsFromDOM();
    	document.querySelector('.main-title').firstElementChild.textContent = '';

    	var template = document.querySelector('#template-article-full');
    	template.content.querySelector('.article').dataset.id = article.id;
		template.content.querySelector('#article-title').textContent = article.title;
		template.content.querySelector('#article-full-img').src = article.img;
		template.content.querySelector('.article-content').textContent = article.content;
		template.content.querySelector('#article-publname').textContent = article.author;
		template.content.querySelector('#article-date').textContent = formatDate(article.createdAt);
		var tags = template.content.querySelector('.article-tags');

		function formatDate(d) {
			return d.getDate() + '.' + (d.getMonth() + 1) + '.' + d.getFullYear() + ' ' +
			d.getHours() + ':' + d.getMinutes();
		}

		tags.innerHTML = 'Tags: ';

		for(i = 0; i < article.tags.length; i++){
			var tmp = document.createElement('li');
			tmp.innerHTML = "<li>" + article.tags[i] + "</li>";
			tags.appendChild(tmp);
		}
		
		if(!Boolean(userLog.username())){
			template.content.querySelector('.article-footer').removeChild(template.content.querySelector('#article-delete'));
			template.content.querySelector('.article-footer').removeChild(template.content.querySelector('#article-change'));
		}

    	document.querySelector('.article-list').appendChild(template.content.querySelector('.article').cloneNode(true));
		
    	if(Boolean(userLog.username())){
    		document.querySelector('#article-delete').addEventListener('click', articleFullDeleteHandler);
    		document.querySelector('#article-change').addEventListener('click', articleFullChangeHandler);
    	}

    	function articleFullDeleteHandler(){
    		articleContent.removeArticle(document.querySelector('.article').dataset.id);
			popularTags.init(2);
    		mainPage.loadMainPage();
    	}

    	function articleFullChangeHandler(){
    		var id = document.querySelector('.article').dataset.id;
    		var article = articleContent.getArticle(id);


    		window.onscroll = 0;
    		document.querySelector('.main-title').firstElementChild.textContent = 'Change news';
    		popularTags.removeTagsFromDOM();
    		articleRenderer.removeArticlesFromDom();

    		var template = document.querySelector('#template-add-article');
    		template.content.querySelector('.article').dataset.id = article.id;
    		var tags = popularTags.allTags;
    		var tagSelector = template.content.querySelector('.input-tags');
    		tagSelector.innerHTML = '';
    		var tmp1 = document.createElement('option');
    		tmp1.innerHTML = '<option disabled>Suggested tags</option>';
    		tagSelector.appendChild(tmp1);
    		tags.forEach(function(item){
    			var tmp = document.createElement('option');
    			tmp.innerHTML = '<option value=\'' + item + '\'>' + item + '</option>';
    			tagSelector.appendChild(tmp);
    		});

			template.content.querySelector('.input-button').setAttribute('onclick', "changeSubmitHandler()");

    		document.querySelector('.article-list').appendChild(template.content.querySelector('.article').cloneNode(true));
			document.forms.add.title.value = article.title;
			document.forms.add.summary.value = article.summary;
			document.forms.add.content.value = article.content;
			document.forms.add.img.value = article.img;
			document.forms.add.tags.value = article.tags.join(' ');

    		document.querySelector('.input-tags').addEventListener('change', tagSelectorHandler);

    		function tagSelectorHandler(event){
    			var target = event.currentTarget.value;
    			var text = document.forms.add.tags;
    			var tmp = text.value.split(' ');
    			var key = false;

    			tmp.forEach(function(item){
    				if(item == target){
    					key = true;
    				}
    			});
    			if(key){
    				text.value = tmp.map(function(item){
    					if(item == target){
    						return '';
    					}
    					return item;
    				}).join(' ');
    			}
    			else if(target == 'Suggested tags');
    			else{
    				text.value += ' ' + target;
    			}
    		}
    	}	
	} 
}

function changeSubmitHandler(){
	var form = document.forms.add;
	if(form.title.value != "" && form.summary.value != "" && form.content.value != ""){
		var article = {
			id: '0',
			title: form.title.value,
			img: "",
			summary: form.summary.value,
			content: form.content.value,
			createdAt: new Date(),
			author:  userLog.username(),
		}
		article.img = form.img.value;

		var tags = form.tags.value.split(' ');

		for(var i = 0; i < tags.length; i++){
			if(tags[i].length == 0){
				tags.splice(i,1);
				i--;
			}
		}

		article.tags = tags;
		article.id = document.querySelector('.article').dataset.id;

		articleContent.editArticle(article.id, article);
		
		popularTags.init(2);
		mainPage.loadMainPage();
	}
}




document.addEventListener('DOMContentLoaded', startApp);
function startApp(){
	articleContent.storeArticles();
	articleRenderer.init();
	userLog.renderUser();
	popularTags.init(2);
	articleContent.authorsInit();
	mainPage.loadMainPage();

	addEvents();
}





function addEvents(){
	document.querySelector('#aMain').addEventListener('click', aMain);
	document.querySelector('#aAdd').addEventListener('click', aAdd);
	document.querySelector('#aSearch').addEventListener('click', aSearchClosed);	
	logInfoAddEvents();

	function aMain(event){
		mainPage.loadMainPage();
	}

	function aAdd(event){
		window.onscroll = 0;
		document.querySelector('.main-title').firstElementChild.textContent = 'Add news';
		popularTags.removeTagsFromDOM();
		articleRenderer.removeArticlesFromDom();

  		var template = document.querySelector('#template-add-article');
  		var tags = popularTags.allTags;
  		var tagSelector = template.content.querySelector('.input-tags');
  		tagSelector.innerHTML = '';
  		var tmp1 = document.createElement('option');
  		tmp1.innerHTML = '<option disabled>Suggested tags</option>';
  		tagSelector.appendChild(tmp1);
  		tags.forEach(function(item){
  			var tmp = document.createElement('option');
  			tmp.innerHTML = '<option value=\'' + item + '\'>' + item + '</option>';
  			tagSelector.appendChild(tmp);
  		});
		document.querySelector('.article-list').appendChild(template.content.querySelector('.article').cloneNode(true));
		document.querySelector('.input-tags').addEventListener('change', tagSelectorHandler);

		function tagSelectorHandler(event){
			var target = event.currentTarget.value;
			var text = document.forms.add.tags;
			var tmp = text.value.split(' ');
			var key = false;

			tmp.forEach(function(item){
				if(item == target){
					key = true;
				}
			});
			if(key){
				text.value = tmp.map(function(item){
					if(item == target){
						return '';
					}
					return item;
				}).join(' ');
			}
			else if(target == 'Suggested tags');
			else{
				text.value += ' ' + target;
			}
		}
	}

	function aSearchClosed(event){
		this.removeEventListener('click', aSearchClosed);
		this.addEventListener('click', aSearchOpened);

  		var template = document.querySelector('#template-search');

  		var tags = popularTags.allTags;
  		var tagSelector = template.content.querySelector('.search-tags');
  		tagSelector.innerHTML = '';
  		var tmp1 = document.createElement('option');
  		tmp1.innerHTML = '<option disabled>Suggested tags</option>';
  		tagSelector.appendChild(tmp1);
  		tags.forEach(function(item){
  			var tmp = document.createElement('option');
  			tmp.innerHTML = '<option value=\'' + item + '\'>' + item + '</option>';
  			tagSelector.appendChild(tmp);
  		});

  		var authors = articleContent.authors;
  		var authorSelector = template.content.querySelector('.search-author');
  		authorSelector.innerHTML = '';
  		var tmp1 = document.createElement('option');
  		tmp1.innerHTML = '<option disabled>Возможные авторы</option>';
  		authorSelector.appendChild(tmp1);
  		authors.forEach(function(item){
  			var tmp = document.createElement('option');
  			tmp.innerHTML = '<option value=\'' + item + '\'>' + item + '</option>';
  			authorSelector.appendChild(tmp);
  		});

  		document.querySelector('.search').innerHTML = '';
		document.querySelector('.search').appendChild(template.content.querySelector('.search-form').cloneNode(true));

		document.forms.search.createdAfter.addEventListener('change', createdAfterHandler);
		document.forms.search.createdBefore.addEventListener('change', createdBeforeHandler);
		document.forms.search.tags.value = '';

		tags = document.querySelector('.search-tags').addEventListener('change', tagSelectorHandler);

		document.querySelector('.search-button-accept').addEventListener('click', filter);

		function tagSelectorHandler(event){
			var target = event.currentTarget.value;
			var text = document.forms.search.tags;
			var tmp = text.value.split(' ');
			var key = false;

			tmp.forEach(function(item){
				if(item == target){
					key = true;
				}
			});
			if(key){
				text.value = tmp.map(function(item){
					if(item == target){
						return '';
					}
					return item;
				}).join(' ');
			}
			else if(target == 'Suggested tags');
			else{
				text.value += ' ' + target;
			}
		}

		function createdAfterHandler(){
			document.forms.search.createdBefore.setAttribute('min', this.value);
		}

		function createdBeforeHandler(){
			document.forms.search.createdAfter.setAttribute('max', this.value);
		}

		function filter(event){
			var form = document.forms.search;
			var filterConfig = {};
			var date1 = new Date(form.createdAfter.value);
			if(date1 != 'Invalid Date'){
				filterConfig.createdAfter = date1;
			}

			var date2 = new Date(form.createdBefore.value);
			if(date2 != 'Invalid Date'){
				filterConfig.createdBefore = date2;
			}

			var author = form.author.value;
			if(author != 'Suggested authors'){
				filterConfig.author = author;
			}

			var tags = form.tags.value.split(' ');

			for(var i = 0; i < tags.length; i++){
				if(tags[i].length == 0){
					tags.splice(i,1);
					i--;
				}
			}

			filterConfig.tags = tags;

			mainPage.setFilter(filterConfig);

			mainPage.loadMainPage();
		}

	}

	function aSearchOpened(event){
		this.removeEventListener('click', aSearchOpened);
  		document.querySelector('.search').innerHTML = '';
		this.addEventListener('click', aSearchClosed);
	}

}

function inputSubmitHandler(){
	var form = document.forms.add;
	if(form.title.value != "" && form.summary.value != "" && form.content.value != ""){
		var article = {
			id: '0',
			title: form.title.value,
			img: "",
			summary: form.summary.value,
			content: form.content.value,
			createdAt: new Date(),
			author:  userLog.username(),
		}
		article.img = form.img.value;

		var tags = form.tags.value.split(' ');

		for(var i = 0; i < tags.length; i++){
			if(tags[i].length == 0){
				tags.splice(i,1);
				i--;
			}
		}

		article.tags = tags;

		articleContent.addArticle(article);
		

		popularTags.init(2);
		mainPage.loadMainPage();
	}
}

function searchReset(){
  		document.querySelector('.search-input').innerHTML = '';
}

var mainPage = (function(){

	var filterConfig;

	var articleCount = 5;

	function renderArticles() {
		articleRenderer.removeArticlesFromDom();
		var articles = articleContent.getArticles(0, articleCount, filterConfig);
		articleRenderer.insertArticlesInDOM(articles);
	}

	function loadMainPage(){
		articleCount = 5;
		document.querySelector('.main-title').firstElementChild.textContent = 'News';
		popularTags.insertTagsInDOM();
		renderArticles();
		window.onscroll = scrollMainPage;
	}

	function setFilter(filter){
		filterConfig = filter;
	}

	function moreNews(){
		if(articleCount + 5 > articleContent.count()){
			articleCount = articleContent.count();
		}
		else{
			articleCount += 5;
		}
	}

	return{
		moreNews: moreNews,
		setFilter: setFilter,
		renderArticles: renderArticles,
		loadMainPage: loadMainPage
	}

}());

function scrollMainPage(){
	var bottom = document.querySelector('.footer-content').lastElementChild.getBoundingClientRect().top;
	if(window.pageYOffset > bottom){
		mainPage.moreNews();
		mainPage.renderArticles();
	}
}

function logInfoAddEvents(){
	var logInfo = document.querySelector('.log-info');

	if(Boolean(userLog.username())){
		logInfo.addEventListener('mouseover', mouseover);
		logInfo.addEventListener('click', logout);
	}
	else{
		logInfo.addEventListener('click', login);
	}

	function mouseover(){
		logInfo.removeEventListener('mouseover', mouseover);
		logInfo.addEventListener('mouseout', mouseout);
		document.querySelector('.log-info').innerHTML = 'Logout<br/><div id="username">' + userLog.username() + '</div>';
	}

	function mouseout(){
		logInfo.removeEventListener('mouseout', mouseout);
		logInfo.addEventListener('mouseover', mouseover);
		document.querySelector('.log-info').innerHTML = 'Profile<br/><div id="username">' + userLog.username() + '</div>';
	}

	function logout(){
		logInfo.removeEventListener('mouseout', mouseout);
		userLog.init();
		logInfo.removeEventListener('click', logout);
		logInfo.addEventListener('click', login);
	}

	function login(){
		window.onscroll = 0;
		document.querySelector('.main-title').firstElementChild.textContent = 'Login';
		popularTags.removeTagsFromDOM();
		articleRenderer.removeArticlesFromDom();

		var template = document.querySelector('#template-login');
		document.querySelector('.article-list').appendChild(template.content.querySelector('.login-background').cloneNode(true));
	}
}

function loginSubmitHandler(){
	userLog.init(document.forms.login.login.value, document.forms.login.password.value);


	var logInfo = document.querySelector('.log-info');
	if(Boolean(userLog.username())){
		logInfo.removeEventListener('click', login);
		logInfo.addEventListener('mouseover', mouseover);
		logInfo.addEventListener('click', logout);
	}
	mainPage.loadMainPage();

	function mouseover(){
		logInfo.removeEventListener('mouseover', mouseover);
		logInfo.addEventListener('mouseout', mouseout);
		document.querySelector('.log-info').innerHTML = 'Logout<br/><div id="username">' + userLog.username() + '</div>';
	}

	function mouseout(){
		logInfo.removeEventListener('mouseout', mouseout);
		logInfo.addEventListener('mouseover', mouseover);
		document.querySelector('.log-info').innerHTML = 'Profile<br/><div id="username">' + userLog.username() + '</div>';
	}

	function logout(){
		logInfo.removeEventListener('mouseout', mouseout);
		userLog.init();
		logInfo.removeEventListener('click', logout);
		logInfo.addEventListener('click', login);
	}

	function login(){
		window.onscroll = 0;
		document.querySelector('.main-title').firstElementChild.textContent = 'Login';
		popularTags.removeTagsFromDOM();
		articleRenderer.removeArticlesFromDom();

		var template = document.querySelector('#template-login');
		document.querySelector('.article-list').appendChild(template.content.querySelector('.login-background').cloneNode(true));
	}
}


